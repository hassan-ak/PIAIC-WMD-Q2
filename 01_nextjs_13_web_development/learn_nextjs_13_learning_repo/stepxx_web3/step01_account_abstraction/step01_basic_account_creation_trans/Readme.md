# Account Creation and Transaction

Explore a basic implementation of account abstraction using ERC-4337. This example will create an account and initiate a transaction on the Ethereum Goerli testnet.

[Stackup quick start](https://docs.stackup.sh/docs/guides/quickstart)

## Create an Account Abstraction

1. To create an account abstraction using ERC-4337, download the script

   ```cmd
   git clone https://github.com/stackup-wallet/erc-4337-examples.git
   ```

2. Install all dependencies

   ```cmd
   yarn install
   ```

3. Initialize your local configuration.

   ```cmd
   yarn run init
   ```

   this will create a `config.json` file with the following content

   ```json
   {
     "bundlerUrl": "http://localhost:4337",
     "rpcUrl": "http://localhost:8545",
     "signingKey": "***",
     "entryPoint": "***",
     "simpleAccountFactory": "***",
     "paymasterUrl": ""
   }
   ```

   as we are not using local bundler so need to create a bundler instance on [app.stackup.sh](https://app.stackup.sh/sign-in) by selecting Ethereum Goerli network and 0.4.0 bundler version. Copy bundler and node link from the instance and update `bundlerUrl` and `rpcUrl` in the above file.

4. Now create an account

   ```cmd
   yarn run simpleAccount address
   ```

   this will create an account and return the account address (not deployed)

   ```
   SimpleAccount address: 0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF
   ```

## Account Funding

1. Fund the account by using some faucet such as [goerlifaucet](https://goerlifaucet.com/) or from some other wallet.

   ```
   ETH funding hash: 0x022d15042acdd781a3a70997f9802584e322c81d7a7a50c8fba1ff25de3dab61
   ```

2. Fund account with erc-20 token from some fucet or deposit from some other account

   ```
   ERC-20 funding hash: 0x4911a44b9c47793e3f0310ae76564fc1331501c9c6dcaeda0f72f7f658e75713
   ```

## Make eth Transactions

1. Create a transaction by transfering eth to some other address

   ```cmd
   yarn run simpleAccount transfer --to <address> --amount <eth>
   ```

   ```cmd
   yarn run simpleAccount transfer --to 0x42C53eCC67CFf59508ab5f498C863D58426CBFE1 --amount 0.001
   ```

   ```json
   Signed UserOperation: {
      "sender": "0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF",
      "nonce": "0x0",
      "initCode": "0x71d63edcda95c61d6235552b5bc74e32d8e2527b5fbfb9cf0000000000000000000000006487b2b6129fefd2c933441b59f86b665510139a0000000000000000000000000000000000000000000000000000000000000000",
      "callData": "0xb61d27f600000000000000000000000042c53ecc67cff59508ab5f498c863d58426cbfe100000000000000000000000000000000000000000000000000038d7ea4c6800000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000",
      "callGasLimit": "0x558c",
      "verificationGasLimit": "0x65139",
      "maxFeePerGas": "0x6044403f5c",
      "maxPriorityFeePerGas": "0x26de418",
      "paymasterAndData": "0x",
      "preVerificationGas": "0xafb4",
      "signature": "0x078a46b6a4d8912073c3f03c658e71f167bccd808525f72e48911d3fd4cdc13763fd29196890b33149a1bdf103bbcb2a3d9e1ad440feb479c23b83d8f497c8041b"
   }
   ```

   ```
   UserOpHash: 0x773ed3d83ddce961bb27c1e738f248932b9053c4c51f295152bcd14afaa51624
   ```

   ```
   Transaction hash: 0x3617da3117107915ed74b17993fcdc6d298d63b14ce36a95542315df0e9e487a
   ```

2. Create a batch transaction by transfering eth to multiple other address

   ```cmd
   yarn run simpleAccount batchTransfer --to <address,address> --amount <eth>
   ```

   ```cmd
   yarn run simpleAccount batchTransfer --to 0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF,0x42C53eCC67CFf59508ab5f498C863D58426CBFE1 --amount 0.001
   ```

   ```json
   Signed UserOperation: {
      "sender": "0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF",
      "nonce": "0x0",
      "initCode": "0x",
      "callData": "0xb61d27f60000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000028418dfb3c7000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000020000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af0000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000084b61d27f60000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af00000000000000000000000000000000000000000000000000038d7ea4c6800000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084b61d27f600000000000000000000000042c53ecc67cff59508ab5f498c863d58426cbfe100000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "callGasLimit": "0xf8a2",
      "verificationGasLimit": "0x186a0",
      "maxFeePerGas": "0x4b0b59ba3a",
      "maxPriorityFeePerGas": "0x26de418",
      "paymasterAndData": "0x",
      "preVerificationGas": "0xbc08",
      "signature": "0x5195d96b3d168f2367c4f0dce85957bdfd5564b149d7bdcb8df1b53c5af425746b321121f1c1df00fc1e5bdcaeb317c3ff00faf197b2e4fe0b6363664aadadc91c"
   }
   ```

   ```
   UserOpHash: 0xc45caab37c41c316d520e20b9d8e2a1a01d12b3ca9e8c0dcc9b14d1d4c62e266
   ```

   ```
   Transaction hash: 0x4545691af2c490d33b2e370a8f6910850abed99c783d961e7252775e9ea50c8d
   ```

## Make ERC-20 Transacton

1. Transfer erc-20 tokens to some other account

   ```cmd
   yarn run simpleAccount erc20Transfer --token <address> --to <address> --amount <decimal>
   ```

   ```cmd
   yarn run simpleAccount erc20Transfer --token 0x326C977E6efc84E512bB9C30f76E30c160eD06FB --to 0x42C53eCC67CFf59508ab5f498C863D58426CBFE1 --amount 1
   ```

   ```json
   Signed UserOperation: {
      "sender": "0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF",
      "nonce": "0x1",
      "initCode": "0x",
      "callData": "0xb61d27f6000000000000000000000000326c977e6efc84e512bb9c30f76e30c160ed06fb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000042c53ecc67cff59508ab5f498c863d58426cbfe10000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000",
      "callGasLimit": "0xf423",
      "verificationGasLimit": "0x186a0",
      "maxFeePerGas": "0x617dd2fbdc",
      "maxPriorityFeePerGas": "0x26de418",
      "paymasterAndData": "0x",
      "preVerificationGas": "0xaed0",
      "signature": "0x71e033945c5ae4398fe0e33f01a7981695fa888f1c7a37739f8ae949e8f99de12b603678b78adc5cc27f6229e1174459addc4492d80eb9d9dee10deff1263c8b1c"
   }
   ```

   ```
   UserOpHash: 0x0c6f5e6ce4e9e4c7dbe5f42a073252edf230db71e704fdd2903d2cc226613790
   ```

   ```
   Transaction hash: 0xe05ad3e1366133fda329f4a0910408973ac7b9333b65f8fdcfb3864a65954629
   ```

2. Batch transfer erc-20 tokens to some other accounts

   ```cmd
   yarn run simpleAccount batchErc20Transfer --token <address> --to <address,address> --amount <decimal>
   ```

   ```cmd
   yarn run simpleAccount batchErc20Transfer --token 0x326C977E6efc84E512bB9C30f76E30c160eD06FB --to 0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF,0x42C53eCC67CFf59508ab5f498C863D58426CBFE1 --amount 1
   ```

   ```json
   Signed UserOperation: {
      "sender": "0x4A4943C1b6fED2f7F6Ca1DD6C2222eF75e66b9aF",
      "nonce": "0x2",
      "initCode": "0x",
      "callData": "0xb61d27f60000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020418dfb3c7000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000326c977e6efc84e512bb9c30f76e30c160ed06fb000000000000000000000000326c977e6efc84e512bb9c30f76e30c160ed06fb0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000004a4943c1b6fed2f7f6ca1dd6c2222ef75e66b9af0000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000042c53ecc67cff59508ab5f498c863d58426cbfe10000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "callGasLimit": "0xf32a",
      "verificationGasLimit": "0x186a0",
      "maxFeePerGas": "0x68995325b6",
      "maxPriorityFeePerGas": "0x26de418",
      "paymasterAndData": "0x",
      "preVerificationGas": "0xb9f8",
      "signature": "0x8309b53fc7e5ec650c16f51c220ec2d6446e3eba2b8a4a8b2381234535ca82d8260b3de714d78d6c635cd7a1368e4427c6ec3025d80705d0939bf0e75dd192a61b"
   }
   ```

   ```
   UserOpHash: 0xcd0505915ff388ae75e74665bbbf4f9ac35012b967d34bbf02730100ac9756e2
   ```

   ```
   Transaction hash: 0xb45e5fe6237f552a7ab67ec4af45815b5de678995e11b714252298a714f47e0a
   ```
